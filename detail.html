<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏ö‡πà‡∏≠ - ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡πâ‡∏≥‡∏ö‡∏≤‡∏î‡∏≤‡∏•</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom slider styles */
        .water-level-slider {
            -webkit-appearance: none;
            appearance: none;
            height: 8px;
            border-radius: 5px;
            background: linear-gradient(to right, #3b82f6 0%, #3b82f6 var(--value), #e5e7eb var(--value), #e5e7eb 100%);
            outline: none;
            opacity: 0.8;
            transition: opacity 0.2s;
        }
        
        .water-level-slider:hover {
            opacity: 1;
        }
        
        .water-level-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #2563eb;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .water-level-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #2563eb;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        /* Water level indicator */
        .water-level-line {
            position: absolute;
            right: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(to right, transparent 0%, #3b82f6 20%, #3b82f6 80%, transparent 100%);
            z-index: 10;
            transition: top 0.3s ease;
        }
        
        .water-level-label {
            position: absolute;
            right: 0;
            background: #3b82f6;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            transform: translateY(-50%);
            white-space: nowrap;
            z-index: 11;
            transition: top 0.3s ease;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="bg-blue-600 text-white p-4 shadow-lg">
        <div class="max-w-4xl mx-auto flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <button onclick="goBack()" class="flex items-center space-x-2 hover:bg-blue-700 px-3 py-2 rounded">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                    </svg>
                    <span>‡∏Å‡∏•‡∏±‡∏ö</span>
                </button>
                <h1 id="pageTitle" class="text-lg md:text-xl font-semibold">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏ö‡πà‡∏≠</h1>
            </div>
            <button onclick="window.close()" class="hover:bg-blue-700 p-2 rounded">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-4xl mx-auto p-4 space-y-6">
        <!-- Loading State -->
        <div id="loadingState" class="text-center py-8">
            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
            <p class="mt-2 text-gray-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
        </div>

        <!-- Error State -->
        <div id="errorState" class="hidden bg-red-50 border border-red-200 rounded-lg p-4 text-center">
            <p class="text-red-600">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>
            <button onclick="loadData()" class="mt-2 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">
                ‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡∏°‡πà
            </button>
        </div>

        <!-- Content Container -->
        <div id="contentContainer" class="hidden space-y-6">
            <!-- Basic Info Card -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="text-center">
                        <h3 class="text-sm text-gray-500 mb-1">‡∏£‡∏´‡∏±‡∏™‡∏ö‡πà‡∏≠</h3>
                        <p id="boreholeId" class="text-xl font-bold text-blue-600">#SRN-1027</p>
                    </div>
                    <div class="text-center">
                        <h3 class="text-sm text-gray-500 mb-1">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏∂‡∏Å‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á</h3>
                        <p id="totalDepth" class="text-xl font-bold text-gray-800">52 ‡πÄ‡∏°‡∏ï‡∏£</p>
                    </div>
                    <div class="text-center">
                        <h3 class="text-sm text-gray-500 mb-1">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏ö‡∏≤‡∏î‡∏≤‡∏•</h3>
                        <p id="currentWaterLevel" class="text-xl font-bold text-blue-500">32 ‡πÄ‡∏°‡∏ï‡∏£</p>
                    </div>
                </div>
            </div>

            <!-- Water Level Control -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-lg font-semibold mb-4 text-gray-800">‡∏õ‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏ö‡∏≤‡∏î‡∏≤‡∏•</h2>
                <div class="space-y-4">
                    <div class="flex items-center space-x-4">
                        <label class="text-sm font-medium text-gray-700 w-20">‡∏£‡∏∞‡∏î‡∏±‡∏ö:</label>
                        <input type="range" id="waterLevelSlider" class="flex-1 water-level-slider" 
                               min="0" max="52" value="32" step="0.1">
                        <span id="waterLevelValue" class="text-sm font-medium text-blue-600 w-16">32.0 ‡∏°.</span>
                    </div>
                    <div class="text-xs text-gray-500">
                        <span>0 ‡∏°.</span>
                        <span class="float-right">52 ‡∏°.</span>
                    </div>
                </div>
            </div>

            <!-- Soil Diagram -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-lg font-semibold mb-4 text-gray-800">‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á‡∏ä‡∏±‡πâ‡∏ô‡∏î‡∏¥‡∏ô</h2>
                <div class="relative border-2 border-blue-300 rounded-lg p-4 bg-gradient-to-b from-blue-50 to-blue-100" style="height: 400px;">
                    <!-- Water level indicator (will be positioned dynamically) -->
                    <div id="waterLevelIndicator" class="water-level-line"></div>
                    <div id="waterLevelLabel" class="water-level-label">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏ö‡∏≤‡∏î‡∏≤‡∏• 32.0m</div>
                    
                    <!-- Soil layers container -->
                    <div id="soilLayersContainer" class="relative h-full">
                        <!-- Soil layers will be dynamically inserted here -->
                    </div>
                </div>
            </div>

            <!-- Information Boxes - pH moved to first position -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- pH Values Box - Priority position -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-lg font-semibold mb-4 text-gray-800 border-b pb-2">‡∏Ñ‡πà‡∏≤ pH</h2>
                    <div id="phValuesContainer" class="space-y-3">
                        <!-- pH values will be dynamically inserted here -->
                    </div>
                </div>

                <!-- Soil Details Box -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-lg font-semibold mb-4 text-gray-800 border-b pb-2">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ä‡∏±‡πâ‡∏ô‡∏î‡∏¥‡∏ô</h2>
                    <div id="soilDetailsContainer" class="space-y-3">
                        <!-- Soil details will be dynamically inserted here -->
                    </div>
                </div>
            </div>

            <!-- Soil Comparison Chart Section -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-lg font-semibold mb-4 text-gray-800 border-b pb-2">‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ä‡∏±‡πâ‡∏ô‡∏î‡∏¥‡∏ô (0-100 ‡πÄ‡∏°‡∏ï‡∏£)</h2>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Actual Data Column -->
                    <div>
                        <h3 class="text-md font-medium mb-3 text-green-700 bg-green-50 p-2 rounded">
                            üìä ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å
                        </h3>
                        <div class="relative">
                            <div id="actualSoilChart" class="w-full bg-gray-100 rounded-lg border-2 border-green-200" style="height: 500px; position: relative;">
                                <!-- Actual soil layers will be inserted here -->
                            </div>
                            <div class="absolute left-0 top-0 bottom-0 w-8 flex flex-col justify-between text-xs text-gray-600 -ml-10">
                                <span>0m</span>
                                <span>25m</span>
                                <span>50m</span>
                                <span>75m</span>
                                <span>100m</span>
                            </div>
                        </div>
                    </div>

                    <!-- Standard Reference Column -->
                    <div>
                        <h3 class="text-md font-medium mb-3 text-blue-700 bg-blue-50 p-2 rounded">
                            üìö ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö (‡∏ä‡∏±‡πâ‡∏ô‡∏î‡∏¥‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡πÉ‡∏ô‡πÑ‡∏ó‡∏¢)
                        </h3>
                        <div class="relative">
                            <div id="referenceSoilChart" class="w-full bg-gray-100 rounded-lg border-2 border-blue-200" style="height: 500px; position: relative;">
                                <!-- Reference soil layers will be inserted here -->
                            </div>
                            <div class="absolute left-0 top-0 bottom-0 w-8 flex flex-col justify-between text-xs text-gray-600 -ml-10">
                                <span>0m</span>
                                <span>25m</span>
                                <span>50m</span>
                                <span>75m</span>
                                <span>100m</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Legend -->
                <div class="mt-6 p-4 bg-gray-50 rounded-lg">
                    <h4 class="font-medium mb-2 text-gray-700">‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå:</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                        <div class="space-y-2">
                            <div class="flex items-center space-x-2">
                                <div class="w-4 h-4 bg-green-500 rounded"></div>
                                <span>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <div class="w-4 h-4 bg-blue-500 rounded"></div>
                                <span>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö</span>
                            </div>
                        </div>
                        <div class="space-y-2">
                            <div class="flex items-center space-x-2">
                                <div class="w-4 h-1 bg-blue-400"></div>
                                <span>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏ö‡∏≤‡∏î‡∏≤‡∏•</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <div class="w-4 h-1 bg-gray-400 border-dashed border"></div>
                                <span>‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Function to render comparison soil charts
        function renderSoilComparisonCharts() {
            renderActualSoilChart();
            renderReferenceSoilChart();
        }

        // Render actual soil data chart
        function renderActualSoilChart() {
            const container = document.getElementById('actualSoilChart');
            container.innerHTML = '';

            console.log('Rendering actual soil chart with data:', boreholeData);
            console.log('Soil layers:', boreholeData.soilLayers);

            const maxDepth = 100; // Max depth for comparison (100m)
            const actualMaxDepth = Math.min(boreholeData.totalDepth, maxDepth);

            // Check if we have soil layers data
            if (!boreholeData.soilLayers || boreholeData.soilLayers.length === 0) {
                console.warn('No soil layers data available');
                // Create a default layer to show something
                const defaultLayer = {
                    name: '‡∏ä‡∏±‡πâ‡∏ô‡∏î‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏',
                    startDepth: 0,
                    endDepth: Math.min(actualMaxDepth, 20),
                    color: '#CCCCCC',
                    description: '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡∏±‡πâ‡∏ô‡∏î‡∏¥‡∏ô‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î',
                    ph: ''
                };
                boreholeData.soilLayers = [defaultLayer];
            }

            // Create soil layers
            boreholeData.soilLayers.forEach((layer, index) => {
                console.log(`Processing layer ${index}:`, layer);
                
                if (layer.startDepth < maxDepth) {
                    const layerStartDepth = Math.max(0, layer.startDepth);
                    const layerEndDepth = Math.min(maxDepth, layer.endDepth);
                    const layerHeight = ((layerEndDepth - layerStartDepth) / maxDepth) * 100;
                    const layerTop = (layerStartDepth / maxDepth) * 100;

                    console.log(`Layer ${index} rendering:`, {
                        startDepth: layerStartDepth,
                        endDepth: layerEndDepth,
                        height: layerHeight,
                        top: layerTop,
                        color: layer.color
                    });

                    const layerElement = document.createElement('div');
                    layerElement.className = 'absolute w-full border-r-4 border-green-500 transition-all duration-300 hover:shadow-lg cursor-pointer';
                    layerElement.style.cssText = `
                        top: ${layerTop}%;
                        height: ${layerHeight}%;
                        background: linear-gradient(135deg, ${layer.color}dd, ${layer.color}ff);
                        border-left: 3px solid ${layer.color};
                        color: ${getTextColor(layer.color)};
                        z-index: 2;
                    `;

                    layerElement.innerHTML = `
                        <div class="p-2 h-full flex flex-col justify-center text-xs">
                            <div class="font-bold">${layer.name}</div>
                            <div class="opacity-90">${layerStartDepth.toFixed(0)}-${layerEndDepth.toFixed(0)}m</div>
                            ${layer.ph ? `<div class="text-xs mt-1 bg-black bg-opacity-20 px-1 rounded">pH ${layer.ph}</div>` : ''}
                        </div>
                    `;

                    layerElement.title = `${layer.name}\n‡∏•‡∏∂‡∏Å: ${layerStartDepth}-${layerEndDepth} ‡∏°.\n${layer.description}${layer.ph ? `\npH: ${layer.ph}` : ''}`;

                    container.appendChild(layerElement);
                    console.log(`Layer ${index} added to container`);
                }
            });

            // Add water level indicator
            if (boreholeData.waterLevel <= maxDepth) {
                const waterLevelTop = (boreholeData.waterLevel / maxDepth) * 100;
                const waterIndicator = document.createElement('div');
                waterIndicator.className = 'absolute w-full z-10';
                waterIndicator.style.cssText = `
                    top: ${waterLevelTop}%;
                    height: 3px;
                    background: linear-gradient(to right, transparent 0%, #3b82f6 10%, #3b82f6 90%, transparent 100%);
                    box-shadow: 0 0 10px rgba(59, 130, 246, 0.6);
                `;

                const waterLabel = document.createElement('div');
                waterLabel.className = 'absolute right-0 bg-blue-600 text-white text-xs px-2 py-1 rounded-l transform -translate-y-1/2';
                waterLabel.style.cssText = `
                    top: ${waterLevelTop}%;
                    z-index: 11;
                `;
                waterLabel.textContent = `‡∏ô‡πâ‡∏≥‡∏ö‡∏≤‡∏î‡∏≤‡∏• ${boreholeData.waterLevel}m`;

                container.appendChild(waterIndicator);
                container.appendChild(waterLabel);
            }

            // Add depth markers for actual data
            for (let depth = 0; depth <= maxDepth; depth += 20) {
                if (depth <= actualMaxDepth) {
                    const markerTop = (depth / maxDepth) * 100;
                    const marker = document.createElement('div');
                    marker.className = 'absolute left-0 text-xs text-gray-600 font-bold bg-white px-1 border border-gray-300 rounded';
                    marker.style.cssText = `
                        top: ${markerTop}%;
                        transform: translateY(-50%);
                        z-index: 12;
                        margin-left: -15px;
                    `;
                    marker.textContent = `${depth}m`;
                    container.appendChild(marker);
                }
            }

            // Add a boundary indicator for actual data limit
            if (actualMaxDepth < maxDepth) {
                const boundaryTop = (actualMaxDepth / maxDepth) * 100;
                const boundary = document.createElement('div');
                boundary.className = 'absolute w-full border-t-4 border-dashed border-gray-400 z-10';
                boundary.style.cssText = `
                    top: ${boundaryTop}%;
                `;

                const boundaryLabel = document.createElement('div');
                boundaryLabel.className = 'absolute right-0 bg-gray-500 text-white text-xs px-2 py-1 rounded-l';
                boundaryLabel.style.cssText = `
                    top: ${boundaryTop}%;
                    transform: translateY(-50%);
                    z-index: 11;
                `;
                boundaryLabel.textContent = `‡∏Ç‡∏µ‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${actualMaxDepth}m`;

                container.appendChild(boundary);
                container.appendChild(boundaryLabel);
            }
        }

        // Render reference soil data chart
        function renderReferenceSoilChart() {
            const container = document.getElementById('referenceSoilChart');
            container.innerHTML = '';

            const maxDepth = 100; // Standard 100m depth

            // Create reference soil layers
            referenceSoilLayers.forEach((layer, index) => {
                const layerHeight = ((layer.endDepth - layer.startDepth) / maxDepth) * 100;
                const layerTop = (layer.startDepth / maxDepth) * 100;

                const layerElement = document.createElement('div');
                layerElement.className = 'absolute w-full border-r-4 border-blue-500 transition-all duration-300 hover:shadow-lg cursor-pointer';
                layerElement.style.cssText = `
                    top: ${layerTop}%;
                    height: ${layerHeight}%;
                    background: linear-gradient(135deg, ${layer.color}dd, ${layer.color}ff);
                    border-left: 3px solid ${layer.color};
                    color: ${getTextColor(layer.color)};
                    z-index: 2;
                `;

                layerElement.innerHTML = `
                    <div class="p-2 h-full flex flex-col justify-center text-xs">
                        <div class="font-bold">${layer.name}</div>
                        <div class="opacity-90">${layer.startDepth}-${layer.endDepth}m</div>
                        <div class="text-xs mt-1 bg-black bg-opacity-20 px-1 rounded">pH ${layer.ph}</div>
                    </div>
                `;

                layerElement.title = `${layer.name}\n‡∏•‡∏∂‡∏Å: ${layer.startDepth}-${layer.endDepth} ‡∏°.\n${layer.description}\npH: ${layer.ph}`;

                container.appendChild(layerElement);
            });

            // Add standard water levels (common depths in Thailand)
            const standardWaterLevels = [15, 25, 40]; // Common groundwater depths
            standardWaterLevels.forEach((depth, index) => {
                const waterLevelTop = (depth / maxDepth) * 100;
                const opacity = index === 0 ? 0.8 : 0.4; // First level more prominent

                const waterIndicator = document.createElement('div');
                waterIndicator.className = 'absolute w-full';
                waterIndicator.style.cssText = `
                    top: ${waterLevelTop}%;
                    height: 2px;
                    background: linear-gradient(to right, transparent 0%, rgba(59, 130, 246, ${opacity}) 10%, rgba(59, 130, 246, ${opacity}) 90%, transparent 100%);
                    z-index: 5;
                `;

                if (index === 0) {
                    const waterLabel = document.createElement('div');
                    waterLabel.className = 'absolute right-0 bg-blue-500 text-white text-xs px-2 py-1 rounded-l transform -translate-y-1/2';
                    waterLabel.style.cssText = `
                        top: ${waterLevelTop}%;
                        z-index: 6;
                    `;
                    waterLabel.textContent = `‡∏ô‡πâ‡∏≥‡∏ö‡∏≤‡∏î‡∏≤‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ ${depth}m`;
                    container.appendChild(waterLabel);
                }

                container.appendChild(waterIndicator);
            });

            // Add depth markers for reference data
            for (let depth = 0; depth <= maxDepth; depth += 20) {
                const markerTop = (depth / maxDepth) * 100;
                const marker = document.createElement('div');
                marker.className = 'absolute left-0 text-xs text-gray-600 font-bold bg-white px-1 border border-gray-300 rounded';
                marker.style.cssText = `
                    top: ${markerTop}%;
                    transform: translateY(-50%);
                    z-index: 12;
                    margin-left: -15px;
                `;
                marker.textContent = `${depth}m`;
                container.appendChild(marker);
            }
        }

        // Sample data structure - will be replaced with data from Google Sheet
        let boreholeData = {
            id: 'SRN-1027',
            totalDepth: 52,
            waterLevel: 32,
            soilLayers: [
                {
                    name: '‡∏î‡∏¥‡∏ô‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß',
                    depthRange: '0-8 ‡∏°.',
                    startDepth: 0,
                    endDepth: 8,
                    color: '#B45F35', // ‡∏™‡∏µ‡πÅ‡∏î‡∏á‡∏≠‡∏¥‡∏ê
                    description: '‡∏î‡∏¥‡∏ô‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡πÅ‡∏î‡∏á',
                    ph: '6.8'
                },
                {
                    name: '‡∏î‡∏¥‡∏ô‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß‡∏õ‡∏ô‡∏ó‡∏£‡∏≤‡∏¢',
                    depthRange: '8-20 ‡∏°.',
                    startDepth: 8,
                    endDepth: 20,
                    color: '#D2691E', // ‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•
                    description: '‡∏î‡∏¥‡∏ô‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß‡∏õ‡∏ô‡∏ó‡∏£‡∏≤‡∏¢‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•',
                    ph: '7.1'
                },
                {
                    name: '‡∏´‡∏¥‡∏ô‡∏î‡∏¥‡∏ô‡∏î‡∏≤‡∏ô',
                    depthRange: '20-40 ‡∏°.',
                    startDepth: 20,
                    endDepth: 40,
                    color: '#708090', // ‡∏™‡∏µ‡πÄ‡∏ó‡∏≤
                    description: '‡∏´‡∏¥‡∏ô‡∏î‡∏¥‡∏ô‡∏î‡∏≤‡∏ô‡∏™‡∏µ‡πÄ‡∏ó‡∏≤',
                    ph: '7.5'
                },
                {
                    name: '‡∏ó‡∏£‡∏≤‡∏¢‡∏ù‡∏ô',
                    depthRange: '40-52 ‡∏°.',
                    startDepth: 40,
                    endDepth: 52,
                    color: '#C0C0C0', // ‡∏™‡∏µ‡πÄ‡∏ó‡∏≤‡∏≠‡πà‡∏≠‡∏ô
                    description: '‡∏ó‡∏£‡∏≤‡∏¢‡∏ù‡∏ô‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î (‡∏™‡∏µ‡πÄ‡∏ó‡∏≤‡∏≠‡πà‡∏≠‡∏ô)',
                    ph: '8.2'
                }
            ]
        };

        // Standard reference soil layers for comparison (typical Thai soil profile)
        const referenceSoilLayers = [
            {
                name: '‡∏î‡∏¥‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏î‡∏¥‡∏ô',
                depthRange: '0-2 ‡∏°.',
                startDepth: 0,
                endDepth: 2,
                color: '#8B4513', // ‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡∏î‡∏¥‡∏ô
                description: '‡∏î‡∏¥‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏î‡∏¥‡∏ô‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡πÄ‡∏Ç‡πâ‡∏° ‡∏≠‡∏∏‡∏î‡∏°‡∏î‡πâ‡∏ß‡∏¢‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡∏µ‡∏¢‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏',
                ph: '6.0-7.0'
            },
            {
                name: '‡∏î‡∏¥‡∏ô‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß‡πÅ‡∏Ç‡πá‡∏á',
                depthRange: '2-15 ‡∏°.',
                startDepth: 2,
                endDepth: 15,
                color: '#CD853F', // ‡∏™‡∏µ‡πÄ‡∏õ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ú‡πà
                description: '‡∏î‡∏¥‡∏ô‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß‡πÅ‡∏Ç‡πá‡∏á‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡πÅ‡∏ô‡πà‡∏ô‡∏™‡∏π‡∏á',
                ph: '6.5-7.5'
            },
            {
                name: '‡∏î‡∏¥‡∏ô‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß‡∏≠‡πà‡∏≠‡∏ô',
                depthRange: '15-25 ‡∏°.',
                startDepth: 15,
                endDepth: 25,
                color: '#DEB887', // ‡∏™‡∏µ‡∏Ñ‡∏£‡∏µ‡∏°‡πÄ‡∏Ç‡πâ‡∏°
                description: '‡∏î‡∏¥‡∏ô‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß‡∏≠‡πà‡∏≠‡∏ô‡∏™‡∏µ‡∏Ñ‡∏£‡∏µ‡∏° ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡πÅ‡∏ô‡πà‡∏ô‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á',
                ph: '7.0-8.0'
            },
            {
                name: '‡∏ó‡∏£‡∏≤‡∏¢‡πÅ‡∏õ‡πâ‡∏á',
                depthRange: '25-40 ‡∏°.',
                startDepth: 25,
                endDepth: 40,
                color: '#F5DEB3', // ‡∏™‡∏µ‡∏Ç‡πâ‡∏≤‡∏ß‡∏™‡∏≤‡∏£
                description: '‡∏ó‡∏£‡∏≤‡∏¢‡πÅ‡∏õ‡πâ‡∏á‡∏™‡∏µ‡∏Ñ‡∏£‡∏µ‡∏°‡∏≠‡πà‡∏≠‡∏ô ‡∏ã‡∏∂‡∏°‡∏ú‡πà‡∏≤‡∏ô‡∏ô‡πâ‡∏≥‡πÑ‡∏î‡πâ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á',
                ph: '7.5-8.5'
            },
            {
                name: '‡∏ó‡∏£‡∏≤‡∏¢‡∏´‡∏¢‡∏≤‡∏ö',
                depthRange: '40-60 ‡∏°.',
                startDepth: 40,
                endDepth: 60,
                color: '#F0E68C', // ‡∏™‡∏µ‡∏Å‡∏≤‡∏Å‡∏µ
                description: '‡∏ó‡∏£‡∏≤‡∏¢‡∏´‡∏¢‡∏≤‡∏ö‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á‡∏≠‡πà‡∏≠‡∏ô ‡∏ã‡∏∂‡∏°‡∏ú‡πà‡∏≤‡∏ô‡∏ô‡πâ‡∏≥‡πÑ‡∏î‡πâ‡∏î‡∏µ',
                ph: '8.0-8.5'
            },
            {
                name: '‡∏Å‡∏£‡∏ß‡∏î‡πÅ‡∏•‡∏∞‡∏ó‡∏£‡∏≤‡∏¢',
                depthRange: '60-80 ‡∏°.',
                startDepth: 60,
                endDepth: 80,
                color: '#D3D3D3', // ‡∏™‡∏µ‡πÄ‡∏ó‡∏≤‡∏≠‡πà‡∏≠‡∏ô
                description: '‡∏Å‡∏£‡∏ß‡∏î‡∏õ‡∏ô‡∏ó‡∏£‡∏≤‡∏¢‡∏™‡∏µ‡πÄ‡∏ó‡∏≤‡∏≠‡πà‡∏≠‡∏ô ‡∏ã‡∏∂‡∏°‡∏ú‡πà‡∏≤‡∏ô‡∏ô‡πâ‡∏≥‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏°‡∏≤‡∏Å',
                ph: '8.0-9.0'
            },
            {
                name: '‡∏´‡∏¥‡∏ô‡∏ó‡∏£‡∏≤‡∏¢',
                depthRange: '80-100 ‡∏°.',
                startDepth: 80,
                endDepth: 100,
                color: '#A9A9A9', // ‡∏™‡∏µ‡πÄ‡∏ó‡∏≤‡πÄ‡∏Ç‡πâ‡∏°
                description: '‡∏´‡∏¥‡∏ô‡∏ó‡∏£‡∏≤‡∏¢‡∏™‡∏µ‡πÄ‡∏ó‡∏≤‡πÄ‡∏Ç‡πâ‡∏° ‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏£‡∏∏‡∏ô',
                ph: '8.5-9.0'
            }
        ];

        // Get URL parameters
        function getUrlParameter(name) {
            name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
            const regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
            const results = regex.exec(location.search);
            return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
        }

        // Load data based on URL parameters or from Google Sheet
        async function loadData() {
            try {
                const boreholeId = getUrlParameter('id');
                const totalDepth = getUrlParameter('totalDepth');
                const waterLevel = getUrlParameter('waterLevel');
                const soilLayersParam = getUrlParameter('soilLayers');
                
                if (boreholeId) {
                    // Use data from URL parameters if available
                    if (totalDepth && waterLevel) {
                        boreholeData.id = boreholeId;
                        boreholeData.totalDepth = parseFloat(totalDepth) || 52;
                        boreholeData.waterLevel = parseFloat(waterLevel) || 32;
                        
                        // Parse soil layers if available
                        if (soilLayersParam) {
                            try {
                                const soilLayers = JSON.parse(decodeURIComponent(soilLayersParam));
                                console.log('Parsed soil layers from URL:', soilLayers);
                                
                                if (Array.isArray(soilLayers) && soilLayers.length > 0) {
                                    // Convert to the format expected by detail.html
                                    boreholeData.soilLayers = soilLayers.map((layer, index) => {
                                        // Parse depth range from string like "6.80 ‡∏°." or "0-8 ‡∏°." or "8-20"
                                        let startDepth, endDepth;
                                        
                                        if (layer.depth) {
                                            const depthStr = layer.depth.replace(/[‡∏°\.]/g, '').trim();
                                            console.log(`Processing depth string: "${layer.depth}" -> "${depthStr}"`);
                                            
                                            if (depthStr.includes('-')) {
                                                // Format: "0-8" or "8-20"
                                                const depthParts = depthStr.split('-');
                                                startDepth = parseFloat(depthParts[0]) || 0;
                                                endDepth = parseFloat(depthParts[1]) || (startDepth + 10);
                                            } else {
                                                // Format: "6.80" - single depth value, treat as layer thickness from surface
                                                const thickness = parseFloat(depthStr) || 10;
                                                startDepth = 0; // Always start from surface for single depth values
                                                endDepth = thickness; // Layer goes from 0 to thickness depth
                                                console.log(`Single depth value: thickness=${thickness}, startDepth=${startDepth}, endDepth=${endDepth}`);
                                            }
                                        } else {
                                            // Default depth range if no depth info
                                            startDepth = index * 10;
                                            endDepth = startDepth + 10;
                                        }
                                        
                                        // Ensure we have valid depths
                                        if (endDepth <= startDepth) {
                                            endDepth = startDepth + 10; // Minimum 10m layer
                                        }
                                        
                                        const processedLayer = {
                                            name: layer.name || `‡∏ä‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà ${index + 1}`,
                                            depthRange: layer.depth || `${startDepth}-${endDepth} ‡∏°.`,
                                            startDepth: startDepth,
                                            endDepth: endDepth,
                                            color: layer.color || '#CCCCCC',
                                            description: layer.desc || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î',
                                            ph: layer.ph || ''
                                        };
                                        
                                        console.log(`Layer ${index + 1}:`, processedLayer);
                                        return processedLayer;
                                    });
                                    
                                    // Add additional soil layers to fill the borehole depth if needed
                                    const totalDepthValue = parseFloat(totalDepth) || 45;
                                    const lastLayerEndDepth = boreholeData.soilLayers[boreholeData.soilLayers.length - 1]?.endDepth || 0;
                                    
                                    if (lastLayerEndDepth < totalDepthValue) {
                                        // Add additional layers to fill the remaining depth
                                        const remainingDepth = totalDepthValue - lastLayerEndDepth;
                                        const additionalLayers = [];
                                        
                                        // Create layers of 10m each until we reach total depth
                                        let currentDepth = lastLayerEndDepth;
                                        let layerIndex = boreholeData.soilLayers.length;
                                        
                                        while (currentDepth < totalDepthValue) {
                                            const nextDepth = Math.min(currentDepth + 10, totalDepthValue);
                                            const layerColors = ['#8B4513', '#CD853F', '#DEB887', '#F5DEB3', '#F0E68C', '#D3D3D3'];
                                            const layerNames = ['‡∏î‡∏¥‡∏ô‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß', '‡∏î‡∏¥‡∏ô‡∏£‡πà‡∏ß‡∏ô', '‡∏ó‡∏£‡∏≤‡∏¢‡πÅ‡∏õ‡πâ‡∏á', '‡∏ó‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î', '‡∏ó‡∏£‡∏≤‡∏¢‡∏´‡∏¢‡∏≤‡∏ö', '‡∏Å‡∏£‡∏ß‡∏î'];
                                            
                                            additionalLayers.push({
                                                name: layerNames[layerIndex % layerNames.length] || `‡∏ä‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà ${layerIndex + 1}`,
                                                depthRange: `${currentDepth}-${nextDepth} ‡∏°.`,
                                                startDepth: currentDepth,
                                                endDepth: nextDepth,
                                                color: layerColors[layerIndex % layerColors.length],
                                                description: '‡∏ä‡∏±‡πâ‡∏ô‡∏î‡∏¥‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì',
                                                ph: ''
                                            });
                                            
                                            currentDepth = nextDepth;
                                            layerIndex++;
                                        }
                                        
                                        boreholeData.soilLayers = boreholeData.soilLayers.concat(additionalLayers);
                                        console.log('Added additional soil layers:', additionalLayers);
                                    }
                                    
                                    console.log('Final processed soil layers:', boreholeData.soilLayers);
                                }
                            } catch (e) {
                                console.error('Error parsing soil layers:', e);
                                console.log('Raw soilLayersParam:', soilLayersParam);
                            }
                        }
                    } else {
                        // Try to fetch data from Google Sheet
                        await fetchDataFromSheet(boreholeId);
                    }
                } else {
                    // Use sample data
                    console.log('Using sample data');
                }
                
                document.getElementById('loadingState').classList.add('hidden');
                document.getElementById('contentContainer').classList.remove('hidden');
                
                // Initialize the display
                initializeDisplay();
                
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('loadingState').classList.add('hidden');
                document.getElementById('errorState').classList.remove('hidden');
            }
        }

        // Fetch data from Google Sheet (placeholder for future implementation)
        async function fetchDataFromSheet(boreholeId) {
            // This would fetch actual data from Google Sheet
            // For now, we'll use the sample data
            console.log('Fetching data for borehole:', boreholeId);
            
            // Update sample data with the requested ID
            boreholeData.id = boreholeId;
        }

        // Initialize the display with data
        function initializeDisplay() {
            // Update basic info
            document.getElementById('pageTitle').textContent = `‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏ö‡πà‡∏≠ #${boreholeData.id}`;
            document.getElementById('boreholeId').textContent = `#${boreholeData.id}`;
            document.getElementById('totalDepth').textContent = `${boreholeData.totalDepth} ‡πÄ‡∏°‡∏ï‡∏£`;
            document.getElementById('currentWaterLevel').textContent = `${boreholeData.waterLevel} ‡πÄ‡∏°‡∏ï‡∏£`;

            // Setup water level slider
            const slider = document.getElementById('waterLevelSlider');
            slider.max = boreholeData.totalDepth;
            slider.value = boreholeData.waterLevel;
            updateWaterLevelDisplay(boreholeData.waterLevel);

            // Render soil layers
            renderSoilLayers();
            renderSoilDetails();
            renderPhValues();

            // Render comparison charts
            renderSoilComparisonCharts();

            // Setup slider event listener
            slider.addEventListener('input', function() {
                const newLevel = parseFloat(this.value);
                updateWaterLevelDisplay(newLevel);
                // Update actual chart when water level changes
                renderActualSoilChart();
            });
        }

        // Update water level display
        function updateWaterLevelDisplay(level) {
            document.getElementById('waterLevelValue').textContent = `${level.toFixed(1)} ‡∏°.`;
            document.getElementById('currentWaterLevel').textContent = `${level.toFixed(1)} ‡πÄ‡∏°‡∏ï‡∏£`;
            document.getElementById('waterLevelLabel').textContent = `‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏ö‡∏≤‡∏î‡∏≤‡∏• ${level.toFixed(1)}m`;

            // Update slider background
            const slider = document.getElementById('waterLevelSlider');
            const percentage = (level / boreholeData.totalDepth) * 100;
            slider.style.setProperty('--value', percentage + '%');

            // Update water level indicator position
            updateWaterLevelIndicator(level);
        }

        // Update water level indicator position in soil diagram
        function updateWaterLevelIndicator(level) {
            const percentage = (level / boreholeData.totalDepth) * 100;
            const indicator = document.getElementById('waterLevelIndicator');
            const label = document.getElementById('waterLevelLabel');
            
            indicator.style.top = percentage + '%';
            label.style.top = percentage + '%';
        }

        // Render soil layers in the diagram
        function renderSoilLayers() {
            const container = document.getElementById('soilLayersContainer');
            container.innerHTML = ''; // Clear existing content
            
            console.log('Rendering soil layers in interactive diagram:', boreholeData.soilLayers);
            
            // Create soil layers for the interactive diagram
            const totalDepthValue = boreholeData.totalDepth; // Total depth of borehole
            
            boreholeData.soilLayers.forEach((layer, index) => {
                // Ensure we have valid depth values
                const startDepth = Math.max(0, layer.startDepth || 0);
                const endDepth = Math.min(totalDepthValue, layer.endDepth || startDepth + 1);
                
                // Skip layers that are invalid or beyond the total depth
                if (startDepth >= totalDepthValue || endDepth <= startDepth) {
                    console.warn(`Skipping invalid layer ${index}:`, layer);
                    return;
                }
                
                // Calculate position and size as percentage of total depth
                const layerHeight = ((endDepth - startDepth) / totalDepthValue) * 100;
                const layerTop = (startDepth / totalDepthValue) * 100;
                
                console.log(`Creating interactive layer ${index}:`, {
                    name: layer.name,
                    startDepth: startDepth,
                    endDepth: endDepth,
                    height: layerHeight + '%',
                    top: layerTop + '%',
                    color: layer.color,
                    totalDepth: totalDepthValue
                });
                
                const layerElement = document.createElement('div');
                layerElement.className = 'absolute w-full transition-all duration-300 hover:shadow-lg cursor-pointer border border-gray-300';
                layerElement.style.cssText = `
                    top: ${layerTop}%;
                    height: ${layerHeight}%;
                    background: linear-gradient(135deg, ${layer.color}dd, ${layer.color}ff);
                    border-left: 4px solid ${layer.color};
                    color: ${getTextColor(layer.color)};
                    z-index: 1;
                `;
                
                layerElement.innerHTML = `
                    <div class="p-2 h-full flex flex-col justify-center text-xs">
                        <div class="font-bold">${layer.name}</div>
                        <div class="opacity-90">${startDepth.toFixed(1)}-${endDepth.toFixed(1)}m</div>
                        ${layer.ph ? `<div class="text-xs mt-1 bg-black bg-opacity-20 px-1 rounded">pH ${layer.ph}</div>` : ''}
                    </div>
                `;
                
                layerElement.title = `${layer.name}\n‡∏•‡∏∂‡∏Å: ${startDepth.toFixed(1)}-${endDepth.toFixed(1)} ‡∏°.\n${layer.description}${layer.ph ? `\npH: ${layer.ph}` : ''}`;
                
                container.appendChild(layerElement);
            });
            
            console.log('Interactive soil layers rendered. Total depth:', totalDepthValue);
        }

        // Render soil details in the info box
        function renderSoilDetails() {
            const container = document.getElementById('soilDetailsContainer');
            container.innerHTML = '';

            boreholeData.soilLayers.forEach(layer => {
                const detailElement = document.createElement('div');
                detailElement.className = 'flex items-start space-x-3 p-3 bg-gray-50 rounded-lg';
                detailElement.innerHTML = `
                    <div class="w-4 h-4 rounded-full mt-0.5 flex-shrink-0" style="background-color: ${layer.color};"></div>
                    <div class="flex-1">
                        <div class="font-medium text-sm">${layer.name} (${layer.depthRange})</div>
                        <div class="text-xs text-gray-600 mt-1">${layer.description}</div>
                    </div>
                `;
                container.appendChild(detailElement);
            });
        }

        // Render pH values in the info box
        function renderPhValues() {
            const container = document.getElementById('phValuesContainer');
            container.innerHTML = '';

            boreholeData.soilLayers.forEach(layer => {
                if (layer.ph) {
                    const phElement = document.createElement('div');
                    phElement.className = 'flex items-center justify-between p-3 bg-gray-50 rounded-lg';
                    phElement.innerHTML = `
                        <div class="flex items-center space-x-3">
                            <div class="w-4 h-4 rounded-full" style="background-color: ${layer.color};"></div>
                            <span class="font-medium text-sm">${layer.name} (${layer.depthRange})</span>
                        </div>
                        <span class="text-lg font-bold text-blue-600">pH ${layer.ph}</span>
                    `;
                    container.appendChild(phElement);
                }
            });
        }

        // Helper function to determine text color based on background
        function getTextColor(backgroundColor) {
            if (!backgroundColor || typeof backgroundColor !== 'string') {
                return '#000000'; // Default to black text
            }
            
            // Ensure it starts with #
            if (!backgroundColor.startsWith('#')) {
                backgroundColor = '#' + backgroundColor;
            }
            
            // Ensure it's a valid hex color (6 digits)
            if (backgroundColor.length !== 7) {
                return '#000000'; // Default to black text
            }
            
            try {
                // Convert hex to RGB
                const r = parseInt(backgroundColor.slice(1, 3), 16);
                const g = parseInt(backgroundColor.slice(3, 5), 16);
                const b = parseInt(backgroundColor.slice(5, 7), 16);
                
                // Calculate brightness
                const brightness = (r * 299 + g * 587 + b * 114) / 1000;
                
                return brightness > 128 ? '#000000' : '#FFFFFF';
            } catch (e) {
                console.error('Error parsing background color:', backgroundColor, e);
                return '#000000'; // Default to black text
            }
        }

        // Go back function
        function goBack() {
            // Always go back to index.html
            window.location.href = 'index.html';
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
        });
    </script>
</body>
</html>
